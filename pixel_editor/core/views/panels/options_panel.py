"""
Options panel for the pixel editor
Contains grid, color mode, and zoom controls
"""

# Third-party imports
from PyQt6.QtCore import Qt, pyqtSignal
from PyQt6.QtWidgets import (
    QCheckBox,
    QGroupBox,
    QHBoxLayout,
    QLabel,
    QPushButton,
    QSlider,
    QVBoxLayout,
    QWidget,
)


class OptionsPanel(QWidget):
    """Panel for editor options and zoom controls"""

    # Signals
    gridToggled = pyqtSignal(bool)
    paletteToggled = pyqtSignal(bool)
    zoomChanged = pyqtSignal(int)
    zoomToFit = pyqtSignal()

    def __init__(self, parent=None):
        super().__init__(parent)
        self.init_ui()

    def init_ui(self):
        """Initialize the options panel UI"""
        # Main layout
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)

        # Options group box
        options_group = QGroupBox("Options")
        options_layout = QVBoxLayout()

        # Grid checkbox
        self.grid_checkbox = QCheckBox("Show Grid")
        self.grid_checkbox.setChecked(False)
        self.grid_checkbox.toggled.connect(self.gridToggled.emit)

        # Apply palette checkbox
        self.apply_palette_checkbox = QCheckBox("Apply Palette")
        self.apply_palette_checkbox.setChecked(True)
        self.apply_palette_checkbox.setToolTip(
            "When checked, shows actual palette colors. When unchecked, shows palette indices (0-15) as grayscale values."
        )
        self.apply_palette_checkbox.toggled.connect(self.paletteToggled.emit)

        # Zoom controls group
        zoom_group = QGroupBox("Zoom Controls")
        zoom_group_layout = QVBoxLayout()

        # Zoom slider with label
        zoom_slider_layout = QHBoxLayout()
        zoom_slider_layout.addWidget(QLabel("Zoom:"))

        self.zoom_slider = QSlider(Qt.Orientation.Horizontal)
        self.zoom_slider.setRange(1, 64)
        self.zoom_slider.setValue(4)
        self.zoom_slider.valueChanged.connect(self._on_zoom_changed)

        self.zoom_label = QLabel("4x")
        zoom_slider_layout.addWidget(self.zoom_slider)
        zoom_slider_layout.addWidget(self.zoom_label)

        # Quick zoom buttons
        zoom_buttons_layout = QHBoxLayout()
        self.zoom_buttons = []

        zoom_presets = [("1x", 1), ("2x", 2), ("4x", 4), ("8x", 8), ("16x", 16)]
        for label, value in zoom_presets:
            btn = QPushButton(label)
            btn.clicked.connect(lambda checked, v=value: self.set_zoom(v))
            btn.setMaximumWidth(35)
            zoom_buttons_layout.addWidget(btn)
            self.zoom_buttons.append((btn, value))

        # Fit to window button
        self.fit_btn = QPushButton("Fit")
        self.fit_btn.clicked.connect(self.zoomToFit.emit)
        self.fit_btn.setToolTip("Fit image to visible area")
        zoom_buttons_layout.addWidget(self.fit_btn)

        zoom_group_layout.addLayout(zoom_slider_layout)
        zoom_group_layout.addLayout(zoom_buttons_layout)
        zoom_group.setLayout(zoom_group_layout)

        # Add all to options layout
        options_layout.addWidget(self.grid_checkbox)
        options_layout.addWidget(self.apply_palette_checkbox)
        options_layout.addWidget(zoom_group)
        options_group.setLayout(options_layout)

        # Add to main layout
        layout.addWidget(options_group)

    def _on_zoom_changed(self, value: int):
        """Handle zoom slider change"""
        self.zoom_label.setText(f"{value}x")
        self.zoomChanged.emit(value)

    def set_zoom(self, value: int):
        """Set zoom level programmatically"""
        self.zoom_slider.setValue(value)

    def get_zoom(self) -> int:
        """Get current zoom level"""
        return self.zoom_slider.value()

    def is_grid_visible(self) -> bool:
        """Check if grid is enabled"""
        return self.grid_checkbox.isChecked()

    def is_palette_applied(self) -> bool:
        """Check if palette colors should be shown"""
        return self.apply_palette_checkbox.isChecked()
