[pytest]
# SpritePal parallel test configuration using pytest-xdist
# 
# Installation: pip install pytest-xdist
# 
# Usage Examples:
#   pytest -c tests/pytest_parallel.ini -n auto tests/        # Auto-detect CPU cores
#   pytest -c tests/pytest_parallel.ini -n 4 tests/          # Use 4 workers
#   pytest -c tests/pytest_parallel.ini --dist loadscope tests/  # Distribute by test scope

# Inherit base configuration
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Add spritepal to Python path
pythonpath = .

# Parallel execution configuration
# NOTE: Requires pytest-xdist: pip install pytest-xdist
addopts = 
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    -p no:xvfb

# Qt-specific settings for pytest-qt
qt_api = pyqt6
qt_default_raise = true
qt_wait_timeout = 15000  # Increased for parallel execution

# Qt test filtering
filterwarnings =
    ignore::DeprecationWarning:PyQt6.*
    ignore::RuntimeWarning:PyQt6.*
    ignore:.*QApplication.*:RuntimeWarning
    ignore:.*QThread.*:RuntimeWarning

# Test collection settings
norecursedirs = .git __pycache__ *.egg-info .pytest_cache ui

# Custom markers (same as base config)
markers =
    # Test types
    unit: Unit tests (fast, no external dependencies)
    integration: Integration tests (may require files)
    benchmark: Performance benchmarking tests
    performance: Performance tests
    stress: Stress/load testing
    slow: Slow tests (>1s)
    
    # Qt and GUI markers
    gui: GUI tests requiring Qt application (may be skipped in headless)
    mock_gui: GUI tests that use mocks (safe for headless environments)
    no_gui: Tests that don't require Qt GUI components
    qt_app: Tests requiring QApplication instance
    real_qt: Tests using real Qt components (not mocked)
    no_xvfb: Skip xvfb for specific tests
    
    # Threading markers  
    thread_safety: Thread safety tests
    timer: Tests involving QTimer functionality
    
    # Test infrastructure markers
    mock: Tests using mocks
    no_manager_setup: Tests that skip manager initialization
    manager: Tests focused on testing manager classes
    
    # Stability and regression markers
    stability: Stability/regression tests
    phase1_fixes: Tests validating Phase 1 critical fixes
    memory: Memory management tests
    
    # Timeout marker for tests with custom timeouts
    timeout: Set custom timeout for test
    
    # Dialog testing markers
    mock_dialogs: Tests that mock dialog exec() methods
    
    # Manager isolation markers
    isolated_managers: Tests requiring fresh manager instances (slow)
    
    # Qt exception handling
    qt_no_exception_capture: Disable Qt exception capture for specific tests