============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
PyQt6 6.9.1 -- Qt runtime 6.9.1 -- Qt compiled 6.9.0
rootdir: /mnt/c/CustomScripts/KirbyMax/workshop/exhal-master/spritepal
configfile: pytest.ini
plugins: qt-4.4.0, cov-6.2.1, mock-3.14.1
collecting ... collected 213 items / 65 deselected / 148 selected

tests/test_constants.py::TestConstants::test_memory_offsets PASSED       [  0%]
tests/test_constants.py::TestConstants::test_sprite_format_constants PASSED [  1%]
tests/test_constants.py::TestConstants::test_palette_constants PASSED    [  2%]
tests/test_constants.py::TestConstants::test_file_extensions PASSED      [  2%]
tests/test_constants.py::TestConstants::test_palette_info PASSED         [  3%]
tests/test_constants.py::TestConstants::test_file_patterns PASSED        [  4%]
tests/test_controller.py::TestControllerImports::test_controller_imports PASSED [  4%]
tests/test_controller.py::TestControllerImports::test_pil_to_qpixmap_import PASSED [  5%]
tests/test_controller.py::TestExtractionController::test_init_connects_signals PASSED [  6%]
tests/test_controller.py::TestExtractionController::test_parameter_validation_missing_vram PASSED [  6%]
tests/test_controller.py::TestExtractionController::test_parameter_validation_missing_cgram PASSED [  7%]
tests/test_controller.py::TestExtractionController::test_parameter_validation_missing_both PASSED [  8%]
tests/test_controller.py::TestExtractionController::test_start_extraction_valid_params PASSED [  8%]
tests/test_controller.py::TestExtractionController::test_on_progress_handler PASSED [  9%]
tests/test_controller.py::TestExtractionController::test_on_palettes_ready_handler PASSED [ 10%]
tests/test_controller.py::TestExtractionController::test_on_active_palettes_ready_handler PASSED [ 10%]
tests/test_controller.py::TestExtractionController::test_on_extraction_finished_handler PASSED [ 11%]
tests/test_controller.py::TestExtractionController::test_on_extraction_error_handler PASSED [ 12%]
tests/test_controller.py::TestExtractionController::test_open_in_editor_launcher_found PASSED [ 12%]
tests/test_controller.py::TestExtractionController::test_open_in_editor_launcher_in_subdirectory PASSED [ 13%]
tests/test_controller.py::TestExtractionController::test_open_in_editor_launcher_in_parent_directory PASSED [ 14%]
tests/test_controller.py::TestExtractionController::test_open_in_editor_launcher_not_found PASSED [ 14%]
tests/test_controller.py::TestExtractionController::test_open_in_editor_subprocess_error PASSED [ 15%]
tests/test_controller.py::TestExtractionWorker::test_init_creates_components PASSED [ 16%]
tests/test_controller.py::TestExtractionWorker::test_create_pixmap_from_image_valid_pil PASSED [ 16%]
tests/test_controller.py::TestExtractionWorker::test_create_pixmap_from_image_invalid_format PASSED [ 17%]
tests/test_controller.py::TestExtractionWorker::test_run_full_workflow_success PASSED [ 18%]
tests/test_controller.py::TestExtractionWorker::test_run_error_handling PASSED [ 18%]
tests/test_controller.py::TestExtractionWorker::test_run_without_cgram PASSED [ 19%]
tests/test_controller.py::TestExtractionWorker::test_run_without_oam PASSED [ 20%]
tests/test_controller.py::TestExtractionWorker::test_run_without_metadata_creation PASSED [ 20%]
tests/test_controller.py::TestExtractionWorker::test_run_without_grayscale_creation PASSED [ 21%]
tests/test_controller.py::TestExtractionWorker::test_signal_emission_order PASSED [ 22%]
tests/test_exceptions.py::TestExceptions::test_sprite_pal_error_base PASSED [ 22%]
tests/test_exceptions.py::TestExceptions::test_vram_error PASSED         [ 23%]
tests/test_exceptions.py::TestExceptions::test_cgram_error PASSED        [ 24%]
tests/test_exceptions.py::TestExceptions::test_oam_error PASSED          [ 25%]
tests/test_exceptions.py::TestExceptions::test_extraction_error PASSED   [ 25%]
tests/test_exceptions.py::TestExceptions::test_injection_error PASSED    [ 26%]
tests/test_exceptions.py::TestExceptions::test_validation_error PASSED   [ 27%]
tests/test_exceptions.py::TestExceptions::test_file_format_error PASSED  [ 27%]
tests/test_exceptions.py::TestExceptions::test_tile_error PASSED         [ 28%]
tests/test_exceptions.py::TestExceptions::test_exception_with_no_message PASSED [ 29%]
tests/test_exceptions.py::TestExceptions::test_exception_inheritance_chain PASSED [ 29%]
tests/test_exceptions.py::TestExceptions::test_exception_catch_hierarchy PASSED [ 30%]
tests/test_exceptions.py::TestExceptions::test_exception_attributes PASSED [ 31%]
tests/test_extractor.py::TestSpriteExtractor::test_init PASSED           [ 31%]
tests/test_extractor.py::TestSpriteExtractor::test_load_vram PASSED      [ 32%]
tests/test_extractor.py::TestSpriteExtractor::test_decode_4bpp_tile PASSED [ 33%]
tests/test_extractor.py::TestSpriteExtractor::test_extract_tiles PASSED  [ 33%]
tests/test_extractor.py::TestSpriteExtractor::test_extract_tiles_custom_offset PASSED [ 34%]
tests/test_extractor.py::TestSpriteExtractor::test_extract_tiles_boundary_check PASSED [ 35%]
tests/test_extractor.py::TestSpriteExtractor::test_create_grayscale_image_dimensions[16-128] PASSED [ 35%]
tests/test_extractor.py::TestSpriteExtractor::test_create_grayscale_image_dimensions[8-64] PASSED [ 36%]
tests/test_extractor.py::TestSpriteExtractor::test_create_grayscale_image_dimensions[32-256] PASSED [ 37%]
tests/test_extractor.py::TestSpriteExtractor::test_extract_sprites_grayscale PASSED [ 37%]
tests/test_injector.py::TestEncode4bppTile::test_encode_simple_tile PASSED [ 38%]
tests/test_injector.py::TestEncode4bppTile::test_encode_solid_color_tile PASSED [ 39%]
tests/test_injector.py::TestEncode4bppTile::test_encode_invalid_tile_size PASSED [ 39%]
tests/test_injector.py::TestEncode4bppTile::test_encode_values_clamped PASSED [ 40%]
tests/test_injector.py::TestSpriteInjector::test_load_metadata PASSED    [ 41%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_valid PASSED [ 41%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_wrong_mode PASSED [ 42%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_wrong_dimensions PASSED [ 43%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_too_many_colors PASSED [ 43%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_256_palette_16_colors_used PASSED [ 44%]
tests/test_injector.py::TestSpriteInjector::test_validate_sprite_nonexistent PASSED [ 45%]
tests/test_injector.py::TestSpriteInjector::test_convert_png_to_4bpp PASSED [ 45%]
tests/test_injector.py::TestSpriteInjector::test_convert_png_to_4bpp_rgb_mode PASSED [ 46%]
tests/test_injector.py::TestSpriteInjector::test_inject_sprite_success PASSED [ 47%]
tests/test_injector.py::TestSpriteInjector::test_inject_sprite_with_metadata_offset PASSED [ 47%]
tests/test_injector.py::TestSpriteInjector::test_inject_sprite_offset_too_large PASSED [ 48%]
tests/test_injector.py::TestSpriteInjector::test_inject_sprite_file_error PASSED [ 49%]
tests/test_injector.py::TestSpriteInjector::test_get_extraction_info PASSED [ 50%]
tests/test_injector.py::TestSpriteInjector::test_get_extraction_info_no_metadata PASSED [ 50%]
tests/test_injector.py::TestInjectionWorker::test_worker_successful_injection PASSED [ 51%]
tests/test_injector.py::TestInjectionWorker::test_worker_with_metadata PASSED [ 52%]
tests/test_injector.py::TestInjectionWorker::test_worker_validation_failure PASSED [ 52%]
tests/test_injector.py::TestInjectionWorker::test_worker_exception_handling PASSED [ 53%]
tests/test_palette_manager.py::TestPaletteManager::test_init PASSED      [ 54%]
tests/test_palette_manager.py::TestPaletteManager::test_load_cgram FAILED [ 54%]
tests/test_palette_manager.py::TestPaletteManager::test_extract_palettes FAILED [ 55%]
tests/test_palette_manager.py::TestPaletteManager::test_bgr555_conversion FAILED [ 56%]
tests/test_palette_manager.py::TestPaletteManager::test_get_palette PASSED [ 56%]
tests/test_palette_manager.py::TestPaletteManager::test_get_sprite_palettes PASSED [ 57%]
tests/test_palette_manager.py::TestPaletteManager::test_create_palette_json PASSED [ 58%]
tests/test_palette_manager.py::TestPaletteManager::test_palette_info[8-Kirby (Pink)] PASSED [ 58%]
tests/test_palette_manager.py::TestPaletteManager::test_palette_info[14-Boss/Enemy] PASSED [ 59%]
tests/test_palette_manager.py::TestPaletteManager::test_palette_info[99-Palette 99] PASSED [ 60%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_extract_palettes_with_no_data PASSED [ 60%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_extract_palettes_with_truncated_data PASSED [ 61%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_create_metadata_json PASSED [ 62%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_analyze_oam_palettes_success FAILED [ 62%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_analyze_oam_palettes_error_handling PASSED [ 63%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_analyze_oam_palettes_short_data PASSED [ 64%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_create_palette_json_without_companion_image PASSED [ 64%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_load_cgram_file_error PASSED [ 65%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_bgr555_edge_cases FAILED [ 66%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_palette_json_with_io_error PASSED [ 66%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_metadata_json_with_io_error PASSED [ 67%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_get_palette_boundary_conditions PASSED [ 68%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_get_sprite_palettes_empty PASSED [ 68%]
tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_get_sprite_palettes_partial_data PASSED [ 69%]
tests/test_settings_manager.py::TestSettingsManager::test_init_creates_default_settings PASSED [ 70%]
tests/test_settings_manager.py::TestSettingsManager::test_settings_file_path PASSED [ 70%]
tests/test_settings_manager.py::TestSettingsManager::test_load_existing_settings PASSED [ 71%]
tests/test_settings_manager.py::TestSettingsManager::test_load_corrupted_settings PASSED [ 72%]
tests/test_settings_manager.py::TestSettingsManager::test_save_settings PASSED [ 72%]
tests/test_settings_manager.py::TestSettingsManager::test_get_setting PASSED [ 73%]
tests/test_settings_manager.py::TestSettingsManager::test_set_setting PASSED [ 74%]
tests/test_settings_manager.py::TestSettingsManager::test_get_session_data PASSED [ 75%]
tests/test_settings_manager.py::TestSettingsManager::test_save_session_data PASSED [ 75%]
tests/test_settings_manager.py::TestSettingsManager::test_validate_file_paths PASSED [ 76%]
tests/test_settings_manager.py::TestSettingsManager::test_has_valid_session PASSED [ 77%]
tests/test_settings_manager.py::TestSettingsManager::test_clear_session PASSED [ 77%]
tests/test_settings_manager.py::TestGlobalSettingsInstance::test_get_settings_manager_singleton PASSED [ 78%]
tests/test_settings_manager.py::TestGlobalSettingsInstance::test_get_settings_manager_preserves_state PASSED [ 79%]
tests/test_validation.py::TestFileValidation::test_validate_vram_file_valid PASSED [ 79%]
tests/test_validation.py::TestFileValidation::test_validate_vram_file_invalid_extension PASSED [ 80%]
tests/test_validation.py::TestFileValidation::test_validate_vram_file_too_small PASSED [ 81%]
tests/test_validation.py::TestFileValidation::test_validate_vram_file_too_large PASSED [ 81%]
tests/test_validation.py::TestFileValidation::test_validate_vram_file_nonexistent PASSED [ 82%]
tests/test_validation.py::TestFileValidation::test_validate_cgram_file_valid PASSED [ 83%]
tests/test_validation.py::TestFileValidation::test_validate_cgram_file_too_small PASSED [ 83%]
tests/test_validation.py::TestFileValidation::test_validate_cgram_file_too_large PASSED [ 84%]
tests/test_validation.py::TestFileValidation::test_validate_oam_file_valid PASSED [ 85%]
tests/test_validation.py::TestFileValidation::test_validate_image_file_valid_png PASSED [ 85%]
tests/test_validation.py::TestFileValidation::test_validate_image_file_unsupported_format PASSED [ 86%]
tests/test_validation.py::TestFileValidation::test_validate_json_file_valid PASSED [ 87%]
tests/test_validation.py::TestFileValidation::test_validate_json_file_invalid_extension PASSED [ 87%]
tests/test_validation.py::TestFileValidation::test_validate_json_file_too_large PASSED [ 88%]
tests/test_validation.py::TestValidationEdgeCases::test_empty_file_path PASSED [ 89%]
tests/test_validation.py::TestValidationEdgeCases::test_directory_instead_of_file PASSED [ 89%]
tests/test_validation.py::TestValidationEdgeCases::test_file_with_multiple_extensions PASSED [ 90%]
tests/test_validation.py::TestOffsetValidation::test_validate_offset_valid PASSED [ 91%]
tests/test_validation.py::TestOffsetValidation::test_validate_offset_negative PASSED [ 91%]
tests/test_validation.py::TestOffsetValidation::test_validate_offset_too_large PASSED [ 92%]
tests/test_validation.py::TestOffsetValidation::test_validate_offset_at_boundary PASSED [ 93%]
tests/test_validation.py::TestTileCountValidation::test_validate_tile_count_valid PASSED [ 93%]
tests/test_validation.py::TestTileCountValidation::test_validate_tile_count_negative PASSED [ 94%]
tests/test_validation.py::TestTileCountValidation::test_validate_tile_count_too_large PASSED [ 95%]
tests/test_validation.py::TestTileCountValidation::test_validate_tile_count_custom_max PASSED [ 95%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_normal PASSED [ 96%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_with_path PASSED [ 97%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_invalid_chars PASSED [ 97%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_leading_trailing PASSED [ 98%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_empty PASSED [ 99%]
tests/test_validation.py::TestFilenameeSanitization::test_sanitize_filename_null_byte PASSED [100%]

=================================== FAILURES ===================================
______________________ TestPaletteManager.test_load_cgram ______________________
tests/test_palette_manager.py:65: in test_load_cgram
    palette_manager.load_cgram(f.name)
core/palette_manager.py:30: in load_cgram
    raise ValueError(f"Invalid CGRAM file: {error_msg}")
E   ValueError: Invalid CGRAM file: Invalid file extension: . Allowed: {'.dmp', '.pal', '.bin', '.cgram'}
___________________ TestPaletteManager.test_extract_palettes ___________________
tests/test_palette_manager.py:85: in test_extract_palettes
    assert pal8[1] == [248, 152, 152]  # Pink
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert [255, 156, 156] == [248, 152, 152]
E     
E     At index 0 diff: 255 != 248
E     
E     Full diff:
E       [
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E     -     152,
E     ?       ^
E     +     156,
E     ?       ^
E     -     152,
E     ?       ^
E     +     156,
E     ?       ^
E       ]
__________________ TestPaletteManager.test_bgr555_conversion ___________________
tests/test_palette_manager.py:108: in test_bgr555_conversion
    assert palette_manager.palettes[0][0] == expected
E   assert [255, 255, 255] == [248, 248, 248]
E     
E     At index 0 diff: 255 != 248
E     
E     Full diff:
E       [
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E       ]
_________ TestPaletteManagerExtended.test_analyze_oam_palettes_success _________
tests/test_palette_manager_extended.py:133: in test_analyze_oam_palettes_success
    assert 9 not in active_palettes  # palette 1 -> CGRAM 9 (off-screen)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 9 not in [8, 9, 10, 11, 12, 13, 14, 15]
______________ TestPaletteManagerExtended.test_bgr555_edge_cases _______________
tests/test_palette_manager_extended.py:204: in test_bgr555_edge_cases
    assert palette_manager.palettes[0][0] == [248, 248, 248]  # Max RGB
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert [255, 255, 255] == [248, 248, 248]
E     
E     At index 0 diff: 255 != 248
E     
E     Full diff:
E       [
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E     -     248,
E     ?      ^^
E     +     255,
E     ?      ^^
E       ]
=========================== short test summary info ============================
FAILED tests/test_palette_manager.py::TestPaletteManager::test_load_cgram - ValueError: Invalid CGRAM file: Invalid file extension: . Allowed: {'.dmp', '.pal', '.bin', '.cgram'}
FAILED tests/test_palette_manager.py::TestPaletteManager::test_extract_palettes - assert [255, 156, 156] == [248, 152, 152]
  
  At index 0 diff: 255 != 248
  
  Full diff:
    [
  -     248,
  ?      ^^
  +     255,
  ?      ^^
  -     152,
  ?       ^
  +     156,
  ?       ^
  -     152,
  ?       ^
  +     156,
  ?       ^
    ]
FAILED tests/test_palette_manager.py::TestPaletteManager::test_bgr555_conversion - assert [255, 255, 255] == [248, 248, 248]
  
  At index 0 diff: 255 != 248
  
  Full diff:
    [
  -     248,
  ?      ^^
  +     255,
  ?      ^^
  -     248,
  ?      ^^
  +     255,
  ?      ^^
  -     248,
  ?      ^^
  +     255,
  ?      ^^
    ]
FAILED tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_analyze_oam_palettes_success - assert 9 not in [8, 9, 10, 11, 12, 13, 14, 15]
FAILED tests/test_palette_manager_extended.py::TestPaletteManagerExtended::test_bgr555_edge_cases - assert [255, 255, 255] == [248, 248, 248]
  
  At index 0 diff: 255 != 248
  
  Full diff:
    [
  -     248,
  ?      ^^
  +     255,
  ?      ^^
  -     248,
  ?      ^^
  +     255,
  ?      ^^
  -     248,
  ?      ^^
  +     255,
  ?      ^^
    ]
=========== 5 failed, 143 passed, 65 deselected, 4 warnings in 0.78s ===========
